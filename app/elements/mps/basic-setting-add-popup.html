<!--
@license
Copyright © HatioLab Inc. All rights reserved.
-->
<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/things-ajax/things-ajax.html">
<link rel="import" href="../../bower_components/things-form/things-search-form.html">
<link rel="import" href="../../bower_components/things-grid/things-resource-grid.html">
<link rel="import" href="../../bower_components/things-content/things-resource-menu-content-behavior.html">

<dom-module id="basic-setting-add-popup">
   <template>
      <style>
         :host {
            @apply --layout-flex;
            @apply --layout-vertical;
         }

         #main-container {
            @apply --layout-flex;
            margin: 15px;
            display: grid;
            grid-template:
               "a" 1fr
               "b" auto / 1fr;
         }

         paper-toolbar::shadow #bottomBar {
            @apply --layout-horizontal;
            @apply --layout-end-justified;
         }
      </style>

      <things-ajax id="confirm-ajax" method="POST" content-type="application/json" resource-url="[[menuInfo.resource_url]][[resourceUrl]]"
         last-response="{{confirmResponse}}">
      </things-ajax>

      <div id="main-container">
         <paper-input id="set-name-input" label="[[labels.name]]">
         </paper-input>

         <paper-toolbar id="button-bar">
            <div class="bottom">
               <things-button-bar id="button-group" buttons="[[buttons]]"></things-button-bar>
            </div>
         </paper-toolbar>
      </div>
   </template>

   <script>
      Polymer({
         is: 'basic-setting-add-popup',

         behaviors: [
            Things.ResourceMenuContentBehavior
         ],

         properties: {
            labels: {
               type: Object,
               value: function () {
                  return {
                     name: Things.DataGlobal.t('label.name')
                  };
               }
            },

            // 버튼 
            buttons: {
               type: Array,
               value: function () {
                  return [{
                     id: "cancel-btn",
                     text: 'cancel'
                  }, {
                     id: "confirm-btn",
                     text: 'confirm'
                  }];
               }
            },

            // POST할 url
            resourceUrl: {
               type: String,
               value: function () {
                  return "/create_template";
               }
            }
         },

         listeners: {
            "button-bar.confirm-btn-tap": "requestAddSetting",
            "button-bar.cancel-btn-tap": "cancel",
            "confirm-ajax.things-ajax-response": "confirmSuccess" // 요청 성공
         },

         // 취소
         cancel: function (e) {
            this.close();
         },

         // POST 요청
         requestAddSetting: function () {
            var setName = this.$['set-name-input'].value;
            var ajax = this.$['confirm-ajax'];

            var body = {
               set_name: setName
            };

            ajax.body = body;
            ajax.generateRequest();
            this.close();
         },

         // 요청 성공
         // TODO 건 수 메시지 표시
         confirmSuccess: function (e) {
            var resultCnt = e.detail && e.detail.count;

            this.openInfoMsg({
               type: 'info',
               title: Things.DataGlobal.t('title.info'),
               text: Things.DataGlobal.t('text.refreshing_browser'),
               showConfirmButton: false
            });

            location.reload();
         }
      });
   </script>
</dom-module>