<!--
@license
Copyright © HatioLab Inc. All rights reserved.
-->
<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/things-ajax/things-ajax.html">
<link rel="import" href="../../bower_components/things-form/things-search-form.html">
<link rel="import" href="../../bower_components/things-grid/things-resource-grid.html">
<link rel="import" href="../../bower_components/things-content/things-resource-menu-content-behavior.html">

<!--
  WCS > Wave 수신 및 분배 > Wave 분할 옵션 팝업
-->
<dom-module id="wcs-split-wave-popup">
  <template>
    <style>
      :host {
        @apply --layout-flex;
        @apply --layout-vertical;
      }

      things-resource-grid {
        @apply --layout-vertical;
        @apply --layout-flex;
      }
    </style>

    <things-ajax
      id="confirm-ajax"
      method="POST"
      content-type="application/json"
      resource-url="[[menuInfo.resource_url]][[resourceUrl]]"
      last-response="{{confirmResponse}}">
    </things-ajax>

    <things-resource-form
      id="bandwidth-form"
      form-fields="[[formFields]]"
      column-count=1
      buttons="[[newButtons]]">
    </things-resource-form>
   </template>

  <script>
    Polymer({
      is: 'wcs-split-wave-popup',

      behaviors: [
        Things.ResourceMenuContentBehavior
      ],

      properties: {
        // 폼 필드
        formFields: {
          type: Array,
          value: function() {
            return [{
              name: "com_cd",
              label: Things.DataGlobal.t('label.com_cd'),
              type: "text"
            }, {
              name: "from",
              label: Things.DataGlobal.t('label.from', {
                t: ""
              }),
              type: "positive-number"
            }, {
              name: "to",
              label: Things.DataGlobal.t('label.to'),
              type: "positive-number"
            }];
          }
        },

        // 버튼
        newButtons: {
          type: Array,
          value: function() {
            return [{
              id: "cancel-btn",
              text: 'cancel'
            }, {
              id: "confirm-btn",
              text: 'confirm'
            }];
          }
        },

        // POST할 url
        resourceUrl: {
          type: String,
          value: function() {
            return "/create_by_range";
          }
        }
      },

      listeners: {
        "bandwidth-form.confirm-btn-tap": "requestAddInvoices", // 확인 버튼
        "bandwidth-form.cancel-btn-tap": "close", // 취소 버튼
        "confirm-ajax.things-ajax-response": "confirmSuccess" // 요청 성공
      },

      // POST 요청
      requestAddInvoices: function() {
        var form = this.$['bandwidth-form'];
        var ajax = this.$['confirm-ajax'];

        var body = form.serializeMyForm();
        body.com_cd = body.com_cd;
        body.from = parseInt(body.from);
        body.to = parseInt(body.to);

        ajax.body = body;
        ajax.generateRequest();
        this.close();
      },

      // 요청 성공
      // TODO 건 수 메시지 표시
      confirmSuccess: function(e) {
        var resultCnt = e.detail && e.detail.count;

        this.openConfirmMsg({
          type: 'success',
          title: Things.DataGlobal.t('title.success'),
          text: Things.DataGlobal.t('text.count_x_processed', {
            x: resultCnt
          })
        }, function() {
          searchForm.submitMyForm();
        });
      }
    });
  </script>
</dom-module>